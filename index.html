<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <title>ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø³ÙˆÙ‚ Ù…Ø¹ Ø¨ÙŠØ§Ù†Ø§Øª Ø­Ù‚ÙŠÙ‚ÙŠØ©</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body { font-family: Arial; text-align: center; padding: 20px; }
        canvas { max-width: 600px; margin: auto; }
        button { padding: 10px 20px; margin-top: 10px; }
        h2 { color: #4CAF50; }
    </style>
</head>
<body>
    <h1>ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø³ÙˆÙ‚ Ù…Ø¹ Ø¨ÙŠØ§Ù†Ø§Øª Ø­Ù‚ÙŠÙ‚ÙŠØ©</h1>
    <p>Ø³ÙŠØªÙ… Ù‚Ø±Ø§Ø¡Ø© Ø¨ÙŠØ§Ù†Ø§Øª Ø¢Ø®Ø± 6 Ø´Ù…ÙˆØ¹ Ù„Ø¹Ù…Ù„Ø© Ø§Ù„Ø¨ÙŠØªÙƒÙˆÙŠÙ† Ù…Ù† CoinGecko</p>
    <button onclick="fetchData()">Ø¨Ø¯Ø¡ Ø§Ù„ØªØ­Ù„ÙŠÙ„</button>
    <h2 id="recommendation"></h2>
    <canvas id="chart"></canvas>

    <script>
        async function fetchData() {
            try {
                // Ø§Ø³ØªØ®Ø¯Ø§Ù… Proxy Ù„Ø­Ù„ Ù…Ø´ÙƒÙ„Ø© CORS
                const proxyUrl = 'https://api.allorigins.win/raw?url=';
                const apiUrl = 'https://api.coingecko.com/api/v3/coins/bitcoin/market_chart?vs_currency=usd&days=1&interval=hourly';
                const response = await fetch(proxyUrl + encodeURIComponent(apiUrl));
                const data = await response.json();
                
                // Ù‚Ø±Ø§Ø¡Ø© Ø¢Ø®Ø± 6 Ø´Ù…ÙˆØ¹
                const prices = data.prices.slice(-6).map(p => p[1]);
                const volumes = data.total_volumes.slice(-6).map(v => v[1]);
                
                analyze(prices, volumes);
            } catch (error) {
                document.getElementById('recommendation').innerText = "âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª. Ø­Ø§ÙˆÙ„ Ù…Ø¬Ø¯Ø¯Ù‹Ø§.";
                console.error(error);
            }
        }

        function analyze(closes, volumes) {
            // Ø§Ù„Ù…ØªÙˆØ³Ø· Ø§Ù„Ù…ØªØ­Ø±Ùƒ
            const ma = closes.reduce((a,b) => a+b) / closes.length;

            // Ù…Ø¤Ø´Ø± RSI
            let gains = 0, losses = 0;
            for (let i = 1; i < closes.length; i++) {
                let diff = closes[i] - closes[i-1];
                if (diff > 0) gains += diff;
                else losses -= diff;
            }
            const avgGain = gains / 6;
            const avgLoss = losses / 6;
            const rs = avgGain / (avgLoss || 1);
            const rsi = 100 - (100 / (1 + rs));

            // ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø§ØªØ¬Ø§Ù‡
            let trend = 0;
            for (let i = 1; i < closes.length; i++) {
                if (closes[i] > closes[i-1]) trend++;
                else if (closes[i] < closes[i-1]) trend--;
            }

            const avgVolume = volumes.reduce((a,b) => a+b) / volumes.length;

            let recommendation = "â¸ï¸ Ø§Ù†ØªØ¸Ø± (Ù„Ø§ Ø§ØªØ¬Ø§Ù‡ ÙˆØ§Ø¶Ø­)";
            if (trend >= 4 && rsi < 70 && closes[5] > ma && volumes[5] > avgVolume) {
                recommendation = "âœ… Ø§Ø´ØªØ±Ù (Ø§ØªØ¬Ø§Ù‡ ØµØ§Ø¹Ø¯)";
            } else if (trend <= -4 && rsi > 30 && closes[5] < ma && volumes[5] > avgVolume) {
                recommendation = "ğŸ”» Ø¨Ø¹ (Ø§ØªØ¬Ø§Ù‡ Ù‡Ø§Ø¨Ø·)";
            }

            document.getElementById('recommendation').innerText = recommendation;

            // Ø±Ø³Ù… Ø§Ù„Ø´Ø§Ø±Øª
            const ctx = document.getElementById('chart').getContext('2d');
            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: ['Ø´Ù…Ø¹Ø©1','2','3','4','5','6'],
                    datasets: [
                        { label: 'Ø§Ù„Ø¥ØºÙ„Ø§Ù‚', data: closes, borderColor: 'blue', fill: false },
                        { label: 'MA', data: Array(6).fill(ma), borderColor: 'orange', borderDash: [5,5], fill: false }
                    ]
                },
                options: {
                    plugins: { legend: { position: 'top' } },
                    scales: { y: { beginAtZero: false } }
                }
            });
        }
    </script>
</body>
</html>
