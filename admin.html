<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Batilieu Admin Dashboard</title>
  <!-- FontAwesome for icons (edit, delete, add, social icons) -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css" integrity="sha512-XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX" crossorigin="anonymous" referrerpolicy="no-referrer" />
  <style>
    /* Basic styling to mirror index page layout and make edit controls usable */
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 0;
      background: #f9f9f9;
      color: #333;
    }
    header {
      background: #003366; /* dark blue (for example) */
      color: #fff;
      padding: 20px;
      text-align: center;
      position: relative;
    }
    header .logo {
      max-height: 60px;
      margin-bottom: 10px;
    }
    header .logo img {
      max-height: 60px;
    }
    header h1 {
      margin: 0;
      font-size: 2em;
    }
    /* Logout button in header */
    #logoutBtn {
      position: absolute;
      top: 20px;
      right: 20px;
      background: #c00;
      color: #fff;
      border: none;
      padding: 8px 12px;
      cursor: pointer;
      font-size: 0.9em;
      border-radius: 4px;
    }
    section {
      padding: 40px 20px;
      border-bottom: 1px solid #ddd;
      background: #fff;
    }
    section h2 {
      font-size: 1.5em;
      margin-top: 0;
      margin-bottom: 20px;
      color: #003366;
      border-left: 4px solid #003366;
      padding-left: 10px;
    }
    /* About section */
    #aboutSection p {
      max-width: 800px;
      line-height: 1.6;
    }
    /* Services section */
    .service-item {
      background: #f1f1f1;
      padding: 15px;
      margin-bottom: 10px;
      border-radius: 5px;
      position: relative;
    }
    .service-item h3 {
      margin-top: 0;
    }
    .service-item .delete-btn {
      position: absolute;
      top: 10px;
      right: 10px;
      background: none;
      border: none;
      color: #c00;
      font-size: 1.2em;
      cursor: pointer;
    }
    /* Gallery section */
    .gallery-item {
      display: inline-block;
      margin: 5px;
      position: relative;
    }
    .gallery-item img {
      max-width: 150px;
      max-height: 100px;
      border: 2px solid #ccc;
      border-radius: 4px;
    }
    .gallery-item .delete-btn {
      position: absolute;
      top: 2px;
      right: 2px;
      background: rgba(0,0,0,0.5);
      color: #fff;
      border: none;
      font-size: 0.9em;
      cursor: pointer;
      border-radius: 3px;
      padding: 2px 5px;
      display: none;
    }
    .gallery-item:hover .delete-btn {
      display: inline-block;
    }
    /* Videos section */
    .video-item {
      display: block;
      margin-bottom: 10px;
      position: relative;
    }
    .video-item video {
      max-width: 320px;
      max-height: 180px;
      border: 2px solid #ccc;
      border-radius: 4px;
    }
    .video-item .delete-btn {
      position: absolute;
      top: 5px;
      right: 5px;
      background: rgba(0,0,0,0.5);
      color: #fff;
      border: none;
      font-size: 1em;
      cursor: pointer;
      border-radius: 3px;
      padding: 2px 5px;
    }
    /* Social links section */
    #socialSection .social-item {
      margin: 5px 0;
    }
    #socialSection .social-item i {
      margin-right: 8px;
      font-size: 1.2em;
      vertical-align: middle;
    }
    #socialSection .social-item .delete-btn {
      margin-left: 10px;
      color: #c00;
      background: none;
      border: none;
      cursor: pointer;
      font-size: 1.1em;
      vertical-align: middle;
    }
    /* Add buttons */
    .add-btn {
      display: inline-block;
      margin-top: 15px;
      padding: 6px 10px;
      background: #28a745;
      color: #fff;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 0.9em;
    }
    .add-btn i {
      margin-right: 5px;
    }
    /* Editable fields highlighting */
    [contenteditable="true"] {
      outline: none;
    }
    [contenteditable="true"]:focus {
      background: #ffffcc; /* highlight editable field on focus */
    }
    /* Login form overlay */
    #loginForm {
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      background: rgba(0,0,0,0.5);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1000;
    }
    #loginForm form {
      background: #fff;
      padding: 20px;
      border-radius: 8px;
      width: 300px;
      box-shadow: 0 0 10px rgba(0,0,0,0.3);
      text-align: center;
    }
    #loginForm h2 {
      margin-top: 0;
      margin-bottom: 15px;
      font-size: 1.2em;
    }
    #loginForm input {
      width: 90%;
      padding: 8px;
      margin: 8px 0;
      font-size: 1em;
    }
    #loginForm button {
      padding: 8px 16px;
      font-size: 1em;
      background: #003366;
      color: #fff;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      width: 100%;
      margin-top: 10px;
    }
    /* Hide admin content until logged in */
    #adminContent {
      display: none;
    }
  </style>
</head>
<body>

  <!-- Login Form (shown until admin is authenticated) -->
  <div id="loginForm">
    <form onsubmit="return false;">
      <h2>Admin Login</h2>
      <input type="email" id="loginEmail" placeholder="Email" required /><br/>
      <input type="password" id="loginPassword" placeholder="Password" required /><br/>
      <button type="button" onclick="login()">Login</button>
    </form>
  </div>

  <!-- Admin Content (hidden until login) -->
  <div id="adminContent">
    <!-- Header section: Site Name and Logo -->
    <header>
      <!-- Logo image (editable via file upload) -->
      <div class="logo">
        <img id="logoImg" src="" alt="Logo" />
        <!-- Edit icon for logo -->
        <button class="edit-icon" onclick="document.getElementById('logoFile').click();" title="Change logo" style="background:none;border:none;color:#fff;cursor:pointer;font-size:1.2em; vertical-align:middle;">
          <i class="fas fa-edit"></i>
        </button>
        <input type="file" id="logoFile" accept="image/*" onchange="uploadLogo()" style="display:none;" />
      </div>
      <!-- Site name (contenteditable) -->
      <h1 id="siteName" contenteditable="true" data-path="siteName" title="Edit site name"></h1>
      <!-- Logout button -->
      <button id="logoutBtn" onclick="logout()">Logout</button>
    </header>

    <!-- About section -->
    <section id="aboutSection">
      <h2>À propos</h2>
      <p id="aboutText" contenteditable="true" data-path="about" title="Edit About text"></p>
    </section>

    <!-- Services section -->
    <section id="servicesSection">
      <h2>Nos Services</h2>
      <div id="servicesList"><!-- Services will be loaded here --></div>
      <!-- Add Service Button -->
      <button class="add-btn" onclick="addService()"><i class="fas fa-plus"></i> Ajouter un service</button>
    </section>

    <!-- Gallery section -->
    <section id="gallerySection">
      <h2>Galerie d'Images</h2>
      <div id="galleryList"><!-- Images will be loaded here --></div>
      <!-- Add Image Button -->
      <button class="add-btn" onclick="document.getElementById('newImageFile').click();"><i class="fas fa-plus"></i> Ajouter une image</button>
      <input type="file" id="newImageFile" accept="image/*" onchange="addImage()" style="display:none;" />
    </section>

    <!-- Videos section -->
    <section id="videoSection">
      <h2>Vidéos</h2>
      <div id="videoList"><!-- Videos will be loaded here --></div>
      <!-- Add Video Button -->
      <button class="add-btn" onclick="document.getElementById('newVideoFile').click();"><i class="fas fa-plus"></i> Ajouter une vidéo</button>
      <input type="file" id="newVideoFile" accept="video/*" onchange="addVideo()" style="display:none;" />
    </section>

    <!-- Social Links section -->
    <section id="socialSection">
      <h2>Liens de Réseaux Sociaux</h2>
      <div id="socialLinks"><!-- Social links will be loaded here --></div>
      <!-- Add Social Link Button -->
      <button class="add-btn" onclick="addSocialLink()"><i class="fas fa-plus"></i> Ajouter un lien</button>
    </section>

    <!-- Footer section -->
    <footer id="footerSection" style="background:#003366; color:#fff; text-align:center; padding:20px;">
      <!-- Footer content (e.g., copyright or contact info) -->
      <p id="footerText" contenteditable="true" data-path="footer" title="Edit Footer text"></p>
    </footer>
  </div>

  <!-- Firebase SDKs -->
  <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-database-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-storage-compat.js"></script>
  <script>
    // TODO: Replace the following config object with your Firebase project config.
    
const firebaseConfig = {
  apiKey: "AIzaSyAjZlsPWS2r4O-dJcdyesQgl0yCpuxlEAU",
  authDomain: "batilieu-78862.firebaseapp.com",
  projectId: "batilieu-78862",
  
storageBucket: "batilieu-78862.appspot.com",
messagingSenderId: "99288585792",
  appId: "1:99288585792:web:f78d3fd0174c6b9f4bf1a5",
  measurementId: "G-8Z3WZF47YP"
};

    

// Initialize Firebase
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.database();
    const storage = firebase.storage();

    // Authentication state observer to show/hide login form and admin content
    auth.onAuthStateChanged(user => {
      if (user) {
        // Logged in
        document.getElementById('loginForm').style.display = 'none';
        document.getElementById('adminContent').style.display = 'block';
        loadContent(); // fetch and display content from database
      } else {
        // Not logged in
        document.getElementById('adminContent').style.display = 'none';
        document.getElementById('loginForm').style.display = 'flex';
      }
    });

    // Login function
    function login() {
      const email = document.getElementById('loginEmail').value;
      const password = document.getElementById('loginPassword').value;
      auth.signInWithEmailAndPassword(email, password)
        .catch(error => {
          alert("Login failed: " + error.message);
        });
    }
    // Logout function
    function logout() {
      auth.signOut();
    }

    // Load all content from database and set up listeners
    function loadContent() {
      // Site name
      db.ref('siteName').on('value', snap => {
        const siteNameEl = document.getElementById('siteName');
        siteNameEl.innerText = snap.val() || "Nom du site";
      });
      // Logo URL
      db.ref('logo').on('value', snap => {
        const logoUrl = snap.val();
        if (logoUrl) {
          document.getElementById('logoImg').src = logoUrl;
        }
      });
      // About text
      db.ref('about').on('value', snap => {
        document.getElementById('aboutText').innerText = snap.val() || "Texte À propos...";
      });
      // Services list
      const servicesRef = db.ref('services');
      servicesRef.on('value', snap => {
        const servicesListEl = document.getElementById('servicesList');
        servicesListEl.innerHTML = ''; // clear current list
        snap.forEach(childSnap => {
          const key = childSnap.key;
          const service = childSnap.val();
          // Create service item container
          const itemDiv = document.createElement('div');
          itemDiv.className = 'service-item';
          // Service title
          const titleEl = document.createElement('h3');
          titleEl.contentEditable = "true";
          titleEl.dataset.path = `services/${key}/title`;
          titleEl.innerText = service.title || "Titre du service";
          titleEl.title = "Modifier le titre du service";
          // Service description
          const descEl = document.createElement('p');
          descEl.contentEditable = "true";
          descEl.dataset.path = `services/${key}/description`;
          descEl.innerText = service.description || "Description du service";
          descEl.title = "Modifier la description du service";
          // Delete button for service
          const delBtn = document.createElement('button');
          delBtn.className = 'delete-btn';
          delBtn.innerHTML = '<i class="fas fa-trash"></i>';
          delBtn.title = "Supprimer ce service";
          delBtn.onclick = () => { deleteService(key); };
          // Append elements
          itemDiv.appendChild(titleEl);
          itemDiv.appendChild(descEl);
          itemDiv.appendChild(delBtn);
          servicesListEl.appendChild(itemDiv);
        });
      });
      // Gallery images list
      const galleryRef = db.ref('gallery');
      galleryRef.on('value', snap => {
        const galleryListEl = document.getElementById('galleryList');
        galleryListEl.innerHTML = '';
        snap.forEach(childSnap => {
          const key = childSnap.key;
          const imageUrl = childSnap.val();
          // Create container div
          const imgDiv = document.createElement('div');
          imgDiv.className = 'gallery-item';
          // Image element
          const imgEl = document.createElement('img');
          imgEl.src = imageUrl;
          imgEl.alt = "Gallery Image";
          // Delete button
          const delBtn = document.createElement('button');
          delBtn.className = 'delete-btn';
          delBtn.innerHTML = '<i class="fas fa-trash"></i>';
          delBtn.title = "Supprimer cette image";
          delBtn.onclick = () => { deleteImage(key); };
          // Append
          imgDiv.appendChild(imgEl);
          imgDiv.appendChild(delBtn);
          galleryListEl.appendChild(imgDiv);
        });
      });
      // Videos list
      const videoRef = db.ref('videos');
      videoRef.on('value', snap => {
        const videoListEl = document.getElementById('videoList');
        videoListEl.innerHTML = '';
        snap.forEach(childSnap => {
          const key = childSnap.key;
          const videoUrl = childSnap.val();
          // Container
          const vidDiv = document.createElement('div');
          vidDiv.className = 'video-item';
          // Video element
          const videoEl = document.createElement('video');
          videoEl.src = videoUrl;
          videoEl.controls = true;
          // Delete button
          const delBtn = document.createElement('button');
          delBtn.className = 'delete-btn';
          delBtn.innerHTML = '<i class="fas fa-trash"></i>';
          delBtn.title = "Supprimer cette vidéo";
          delBtn.onclick = () => { deleteVideo(key); };
          // Append
          vidDiv.appendChild(videoEl);
          vidDiv.appendChild(delBtn);
          videoListEl.appendChild(vidDiv);
        });
      });
      // Social links list
      const socialRef = db.ref('social');
      socialRef.on('value', snap => {
        const socialLinksEl = document.getElementById('socialLinks');
        socialLinksEl.innerHTML = '';
        snap.forEach(childSnap => {
          const key = childSnap.key;
          const linkObj = childSnap.val();
          const platformClass = linkObj.icon || "fas fa-link"; // default icon if none
          const url = linkObj.url || "#";
          // Container for a social link item
          const socDiv = document.createElement('div');
          socDiv.className = 'social-item';
          // Icon element
          const iconEl = document.createElement('i');
          iconEl.className = platformClass;
          // URL text element (contenteditable)
          const urlEl = document.createElement('span');
          urlEl.contentEditable = "true";
          urlEl.dataset.path = `social/${key}/url`;
          urlEl.innerText = url;
          urlEl.title = "Modifier l’URL du lien social";
          urlEl.style.padding = "2px 4px";
          urlEl.style.borderBottom = "1px dashed #333";  // underline to denote editable
          // (Note: If needed, one could also allow editing icon class similarly)
          // Delete button
          const delBtn = document.createElement('button');
          delBtn.className = 'delete-btn';
          delBtn.innerHTML = '<i class="fas fa-trash"></i>';
          delBtn.title = "Supprimer ce lien";
          delBtn.onclick = () => { deleteSocialLink(key); };
          // Append elements
          socDiv.appendChild(iconEl);
          socDiv.appendChild(urlEl);
          socDiv.appendChild(delBtn);
          socialLinksEl.appendChild(socDiv);
        });
      });
      // Footer text
      db.ref('footer').on('value', snap => {
        document.getElementById('footerText').innerText = snap.val() || "Texte de pied de page...";
      });
      // Attach blur event listener for all future contenteditable fields to save on edit
      document.addEventListener('focusout', function(e) {
        if (e.target.matches('[contenteditable="true"]')) {
          saveEditable(e.target);
        }
      });
    }

    // Save edited content to Firebase (called on blur of any contenteditable field)
    function saveEditable(element) {
      const path = element.dataset.path;
      if (!path) return;
      let newValue = element.innerText;
      // Write the new value to the specified path in the database
      db.ref(path).set(newValue);
    }

    // Upload a new logo image (from file input) to Firebase Storage
    function uploadLogo() {
      const fileInput = document.getElementById('logoFile');
      if (fileInput.files.length === 0) return;
      const file = fileInput.files[0];
      const storageRef = storage.ref('logo/' + file.name);
      storageRef.put(file).then(snapshot => {
        return snapshot.ref.getDownloadURL();
      }).then(url => {
        // Save the logo URL in database
        db.ref('logo').set(url);
      }).catch(error => {
        alert("Erreur lors de l'upload du logo: " + error);
      }).finally(() => {
        fileInput.value = ""; // reset file input
      });
    }

    // Add a new Service (push a new service object with placeholder values)
    function addService() {
      const newServiceRef = db.ref('services').push();
      newServiceRef.set({
        title: "Nouveau service",
        description: "Description du service"
      });
      // The realtime listener will auto-update the DOM with the new service
    }

    // Delete a service by its key
    function deleteService(key) {
      if (confirm("Supprimer ce service?")) {
        db.ref('services/' + key).remove();
      }
    }

    // Add a new gallery image (upload file to storage then save URL in database)
    function addImage() {
      const fileInput = document.getElementById('newImageFile');
      if (fileInput.files.length === 0) return;
      const file = fileInput.files[0];
      const storageRef = storage.ref('gallery/' + file.name);
      storageRef.put(file).then(snapshot => {
        return snapshot.ref.getDownloadURL();
      }).then(url => {
        // Push the new image URL into the gallery list in DB
        db.ref('gallery').push(url);
      }).catch(error => {
        alert("Erreur lors de l'upload de l'image: " + error);
      }).finally(() => {
        fileInput.value = "";
      });
    }

    // Delete a gallery image by key
    function deleteImage(key) {
      if (confirm("Supprimer cette image?")) {
        // Optionally, could also delete from storage by name if we stored it, but skipping for now
        db.ref('gallery/' + key).remove();
      }
    }

    // Add a new video (upload file to storage then save URL in database)
    function addVideo() {
      const fileInput = document.getElementById('newVideoFile');
      if (fileInput.files.length === 0) return;
      const file = fileInput.files[0];
      const storageRef = storage.ref('videos/' + file.name);
      storageRef.put(file).then(snapshot => {
        return snapshot.ref.getDownloadURL();
      }).then(url => {
        db.ref('videos').push(url);
      }).catch(error => {
        alert("Erreur lors de l'upload de la vidéo: " + error);
      }).finally(() => {
        fileInput.value = "";
      });
    }

    // Delete a video by key
    function deleteVideo(key) {
      if (confirm("Supprimer cette vidéo?")) {
        db.ref('videos/' + key).remove();
      }
    }

    // Add a new social link (adds a default icon and placeholder URL)
    function addSocialLink() {
      // For simplicity, add a generic link icon with placeholder URL
      db.ref('social').push({
        icon: "fas fa-link",   // default icon (chain link)
        url: "https://nouveau-lien"
      });
    }

    // Delete a social link by key
    function deleteSocialLink(key) {
      if (confirm("Supprimer ce lien social?")) {
        db.ref('social/' + key).remove();
      }
    }
  </script>
</body>
</html>