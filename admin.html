<!DOCTYPE html><html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>لوحة تحكم | Batilieu</title>
  <style>
    body { font-family: sans-serif; padding: 20px; direction: rtl; }
    input, textarea { width: 100%; margin-bottom: 10px; padding: 8px; }
    button { padding: 10px 20px; margin-top: 10px; }
    .service-block { border: 1px solid #ccc; padding: 10px; margin-bottom: 10px; }
  </style>
  <script>
    const PASSWORD = "batilieu123";
    const REPO = "momo91338/Batilieu";
    const FILE = "data.json";
    const TOKEN = "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";const CLOUD_NAME = "your_cloud_name_here"; // ضع Cloud name هنا
const UPLOAD_PRESET = "unsigned_preset"; // استخدم unsigned upload preset (أنشئه من Cloudinary)

window.onload = function () {
  const pass = prompt("ادخل كلمة المرور:");
  if (pass !== PASSWORD) {
    alert("كلمة المرور غير صحيحة!");
    window.location.href = "/";
  } else {
    loadData();
  }
};

function addServiceBlock(service = {}) {
  const container = document.getElementById("services");
  const block = document.createElement("div");
  block.className = "service-block";
  block.innerHTML = `
    <input type="text" placeholder="عنوان الخدمة" value="${service.title || ""}" class="s-title">
    <input type="text" placeholder="أيقونة (fas fa-hammer)" value="${service.icon || ""}" class="s-icon">
    <textarea placeholder="وصف الخدمة" class="s-desc">${service.description || ""}</textarea>
    <button onclick="this.parentElement.remove()">حذف الخدمة</button>
  `;
  container.appendChild(block);
}

function loadData() {
  fetch(`https://raw.githubusercontent.com/${REPO}/main/${FILE}`)
    .then(res => res.json())
    .then(data => {
      document.getElementById("siteName").value = data.siteName || "";
      document.getElementById("logo").value = data.logo || "";
      document.getElementById("about").value = data.about || "";
      document.getElementById("video").value = data.video || "";
      document.getElementById("gallery").value = data.gallery ? data.gallery.join(", ") : "";
      document.getElementById("footer").value = data.footer || "";
      document.getElementById("facebook").value = data.social.facebook || "";
      document.getElementById("whatsapp").value = data.social.whatsapp || "";
      document.getElementById("email").value = data.social.email || "";
      document.getElementById("map").value = data.social.map || "";

      data.services.forEach(service => addServiceBlock(service));
    });
}

function saveData() {
  const siteName = document.getElementById("siteName").value;
  const logo = document.getElementById("logo").value;
  const about = document.getElementById("about").value;
  const video = document.getElementById("video").value;
  const gallery = document.getElementById("gallery").value.split(",").map(i => i.trim());
  const footer = document.getElementById("footer").value;
  const facebook = document.getElementById("facebook").value;
  const whatsapp = document.getElementById("whatsapp").value;
  const email = document.getElementById("email").value;
  const map = document.getElementById("map").value;

  const serviceBlocks = document.querySelectorAll(".service-block");
  const services = Array.from(serviceBlocks).map(block => ({
    title: block.querySelector(".s-title").value,
    icon: block.querySelector(".s-icon").value,
    description: block.querySelector(".s-desc").value
  }));

  const finalData = {
    siteName,
    logo,
    about,
    video,
    gallery,
    footer,
    services,
    social: { facebook, whatsapp, email, map }
  };

  const content = btoa(unescape(encodeURIComponent(JSON.stringify(finalData, null, 2))));

  fetch(`https://api.github.com/repos/${REPO}/contents/${FILE}`, {
    method: "GET",
    headers: { "Authorization": `token ${TOKEN}` }
  })
  .then(res => res.json())
  .then(file => {
    fetch(`https://api.github.com/repos/${REPO}/contents/${FILE}`, {
      method: "PUT",
      headers: {
        "Authorization": `token ${TOKEN}`,
        "Content-Type": "application/json"
      },
      body: JSON.stringify({
        message: "تحديث بيانات الموقع",
        content: content,
        sha: file.sha
      })
    })
    .then(() => alert("تم الحفظ بنجاح!"))
    .catch(() => alert("حدث خطأ أثناء الحفظ."));
  });
}

function uploadToCloudinary(fileInput, targetField) {
  const file = fileInput.files[0];
  const formData = new FormData();
  formData.append("file", file);
  formData.append("upload_preset", UPLOAD_PRESET);

  fetch(`https://api.cloudinary.com/v1_1/${CLOUD_NAME}/auto/upload`, {
    method: "POST",
    body: formData
  })
  .then(res => res.json())
  .then(data => {
    document.getElementById(targetField).value = data.secure_url;
    alert("تم رفع الملف بنجاح!");
  })
  .catch(() => alert("فشل رفع الملف"));
}

  </script>
</head>
<body>
  <h2>لوحة التحكم</h2><label>اسم الموقع:</label> <input type="text" id="siteName" />

<label>شعار الموقع (رابط):</label> <input type="text" id="logo" /> <input type="file" onchange="uploadToCloudinary(this, 'logo')" />

<label>عن الشركة:</label>

  <textarea id="about" rows="4"></textarea>  <h3>الخدمات</h3>
  <div id="services"></div>
  <button onclick="addServiceBlock()">+ خدمة جديدة</button><label>رابط الفيديو:</label> <input type="text" id="video" /> <input type="file" onchange="uploadToCloudinary(this, 'video')" />

<label>صور المعرض (مفصولة بفاصلة):</label>

  <textarea id="gallery" rows="2"></textarea><label>حقوق الفوتر:</label> <input type="text" id="footer" />

  <h3>روابط التواصل</h3>
  <input type="text" id="facebook" placeholder="Facebook" />
  <input type="text" id="whatsapp" placeholder="WhatsApp" />
  <input type="text" id="email" placeholder="Email" />
  <input type="text" id="map" placeholder="Google Maps" /><br><br> <button onclick="saveData()">حفظ التعديلات</button>

</body>
</html>