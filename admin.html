<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>لوحة تحكم Batilieu</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-storage-compat.js"></script>

  <style>
    body { font-family: Arial; background: #f2f2f2; margin: 0; color: #333; }
    header, footer { background: #333; color: white; text-align: center; padding: 20px; }
    section { background: white; margin: 15px; padding: 20px; border-radius: 8px; }
    input, textarea, button {
      width: 100%; max-width: 600px; display: block;
      margin: 10px auto; padding: 10px; border-radius: 5px;
      border: 1px solid #ccc;
    }
    .gallery img { width: 120px; margin: 5px; border-radius: 6px; cursor: pointer; }
    .service { background: #f9f9f9; padding: 10px; margin-bottom: 15px; border-radius: 6px; }
    .actions { display: flex; flex-wrap: wrap; gap: 10px; justify-content: center; }
    .actions button { flex: 1; min-width: 120px; }
    #adminPanel { display: none; }
  </style>
</head>
<body>
<!-- واجهة تسجيل الدخول -->
<div id="loginSection">
  <section>
    <h2>تسجيل دخول المدير</h2>
    <input type="email" id="loginEmail" placeholder="البريد الإلكتروني">
    <input type="password" id="loginPassword" placeholder="كلمة المرور">
    <button onclick="login()">دخول</button>
  </section>
</div>

<!-- لوحة التحكم تظهر بعد تسجيل الدخول -->
<div id="adminPanel">
  <header>
    <h1>لوحة تحكم Batilieu</h1>
    <input type="file" id="logoInput" accept="image/*">
    <img id="logoPreview" src="" alt="Logo" style="width: 150px; display: block; margin: 10px auto;">
    <input type="text" id="siteName" placeholder="اسم الموقع">
  </header>

  <section>
    <h2>À propos de nous</h2>
    <textarea id="about" rows="4" placeholder="نص عن الشركة"></textarea>
  </section>

  <section>
    <h2>Nos services</h2>
    <div id="servicesContainer"></div>
    <button onclick="addService()">+ Ajouter un service</button>
  </section>

  <section>
    <h2>Galerie photos</h2>
    <div class="gallery" id="gallery"></div>
    <input type="file" id="imageUpload" accept="image/*">
  </section>

  <section>
    <h2>Vidéo</h2>
    <video id="videoPreview" controls style="width: 100%; max-width: 500px;"></video>
    <input type="file" id="videoUpload" accept="video/*">
  </section>
<section>
    <h2>Réseaux sociaux</h2>
    <input id="facebook" placeholder="Lien Facebook">
    <input id="whatsapp" placeholder="Lien WhatsApp">
    <input id="email" placeholder="Adresse Email">
    <input id="map" placeholder="Lien Google Maps">
  </section>

  <section>
    <h2>Pied de page</h2>
    <input id="footer" placeholder="Texte du footer">
  </section>

  <div class="actions">
    <button onclick="saveChanges()">Enregistrer les modifications</button>
    <button onclick="logout()">Déconnexion</button>
  </div>

  <footer>
    <p>© 2024 Tous droits réservés - Batilieu</p>
  </footer>
</div> <!-- Fin #adminPanel -->
<script>
  // إعداد Firebase
 

const firebaseConfig = {
  apiKey: "AIzaSyC1WIjzBZ0UPdB7ngFl6CngtOgyymmTN_0",
  authDomain: "batilieu-2bbd3.firebaseapp.com",
  projectId: "batilieu-2bbd3",
  storageBucket: "batilieu-2bbd3.appspot.com",
  messagingSenderId: "258256684530",
  appId: "1:258256684530:web:dc56f010b4ade32e47976b",
  measurementId: "G-CBFJ2MCEPR"
};
firebase.initializeApp(firebaseConfig);


  firebase.initializeApp(firebaseConfig);

  const db = firebase.database();
  const storage = firebase.storage();
  const auth = firebase.auth();

  const loginSection = document.getElementById("loginSection");
  const adminPanel = document.getElementById("adminPanel");

  auth.onAuthStateChanged(user => {
    if (user) {
      loginSection.style.display = "none";
      adminPanel.style.display = "block";
      loadData();
    } else {
      loginSection.style.display = "block";
      adminPanel.style.display = "none";
    }
  });

  function login() {
    const email = document.getElementById("loginEmail").value;
    const pass = document.getElementById("loginPassword").value;
    auth.signInWithEmailAndPassword(email, pass).catch(err => alert(err.message));
  }

  function logout() {
    auth.signOut();
  }

  function loadData() {
    db.ref("siteData").once("value").then(snapshot => {
      const data = snapshot.val() || {};
      document.getElementById("siteName").value = data.siteName || "";
      document.getElementById("about").value = data.about || "";
      document.getElementById("footer").value = data.footer || "";
      document.getElementById("logoPreview").src = data.logo || "";
      document.getElementById("videoPreview").src = data.video || "";

      document.getElementById("facebook").value = data.social?.facebook || "";
      document.getElementById("whatsapp").value = data.social?.whatsapp || "";
      document.getElementById("email").value = data.social?.email || "";
      document.getElementById("map").value = data.social?.map || "";

      // Services
      const servicesContainer = document.getElementById("servicesContainer");
      servicesContainer.innerHTML = "";
      (data.services || []).forEach(service => {
        const div = document.createElement("div");
        div.className = "service";
        div.innerHTML = `
          <input placeholder="Titre" value="${service.title || ''}">
          <textarea placeholder="Description">${service.description || ''}</textarea>
          <button onclick="this.parentElement.remove()">Supprimer</button>
        `;
        servicesContainer.appendChild(div);
      });

      // Gallery
      const gallery = document.getElementById("gallery");
      gallery.innerHTML = "";
      (data.gallery || []).forEach(url => {
        const img = document.createElement("img");
        img.src = url;
        img.onclick = () => img.remove();
        gallery.appendChild(img);
      });
    });
  }

  // Ajouter un service
  function addService() {
    const div = document.createElement("div");
    div.className = "service";
    div.innerHTML = `
      <input placeholder="Titre">
      <textarea placeholder="Description"></textarea>
      <button onclick="this.parentElement.remove()">Supprimer</button>
    `;
    document.getElementById("servicesContainer").appendChild(div);
  }

  // Image upload
  document.getElementById("imageUpload").addEventListener("change", e => {
    const file = e.target.files[0];
    const ref = storage.ref("images/" + file.name);
    ref.put(file).then(snap => snap.ref.getDownloadURL()).then(url => {
      const img = document.createElement("img");
      img.src = url;
      img.onclick = () => img.remove();
      document.getElementById("gallery").appendChild(img);
    });
  });

  // Video upload
  document.getElementById("videoUpload").addEventListener("change", e => {
    const file = e.target.files[0];
    const ref = storage.ref("video/" + file.name);
    ref.put(file).then(snap => snap.ref.getDownloadURL()).then(url => {
      document.getElementById("videoPreview").src = url;
    });
  });

  // Logo upload
  document.getElementById("logoInput").addEventListener("change", e => {
    const file = e.target.files[0];
    const ref = storage.ref("logo/" + file.name);
    ref.put(file).then(snap => snap.ref.getDownloadURL()).then(url => {
      document.getElementById("logoPreview").src = url;
    });
  });

  // Enregistrer les modifications
  function saveChanges() {
    const data = {
      siteName: document.getElementById("siteName").value,
      about: document.getElementById("about").value,
      footer: document.getElementById("footer").value,
      logo: document.getElementById("logoPreview").src,
      video: document.getElementById("videoPreview").src,
      gallery: Array.from(document.querySelectorAll("#gallery img")).map(img => img.src),
      services: Array.from(document.querySelectorAll("#servicesContainer .service")).map(service => ({
        title: service.querySelector("input").value,
        description: service.querySelector("textarea").value
      })),
      social: {
        facebook: document.getElementById("facebook").value,
        whatsapp: document.getElementById("whatsapp").value,
        email: document.getElementById("email").value,
        map: document.getElementById("map").value
      }
    };
    db.ref("siteData").set(data).then(() => {
      alert("Modifications enregistrées !");
    });
  }
</script>
</body>
</html>